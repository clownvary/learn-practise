import _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';
import _classCallCheck from 'babel-runtime/helpers/classCallCheck';
import _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';
import _inherits from 'babel-runtime/helpers/inherits';
import _extends from 'babel-runtime/helpers/extends';
import React, { createElement, PureComponent } from 'react';

import getDisplayName from '../shared/getDisplayName';
import { FormFieldPropTypes } from './types';

var NON_LAYOUT_FIELD = 'NonLayoutField';
var formFields = [];
var propTypes = _extends({}, FormFieldPropTypes);

export var registerFormField = function registerFormField(Field) {
  if (formFields.indexOf(Field) < 0) {
    formFields.push(Field);
  }
};
export var isRegisteredField = function isRegisteredField(type) {
  return formFields.indexOf(type) >= 0;
};

var createField = function createField(FieldLayout) {
  var Field = function (_PureComponent) {
    _inherits(Field, _PureComponent);

    function Field() {
      _classCallCheck(this, Field);

      return _possibleConstructorReturn(this, _PureComponent.apply(this, arguments));
    }

    Field.prototype.render = function render() {
      var _props = this.props,
          component = _props.component,
          errMsg = _props.errMsg,
          label = _props.label,
          rest = _objectWithoutProperties(_props, ['component', 'errMsg', 'label']);

      var rules = this.props.rules || '';
      var required = this.props.required || rules.indexOf('required') !== -1;
      var element = void 0;

      if (typeof component === 'string') {
        element = createElement(component, _extends({ label: label }, rest));
      } else {
        element = createElement(component, _extends({ errMsg: errMsg, label: label }, rest));
      }

      if (FieldLayout) {
        return React.createElement(
          FieldLayout,
          _extends({ label: label, errMsg: errMsg, required: required }, rest),
          element
        );
      }

      return element;
    };

    return Field;
  }(PureComponent);

  Field.displayName = 'FormField(' + getDisplayName(FieldLayout || NON_LAYOUT_FIELD) + ')';
  Field.propTypes = propTypes;

  registerFormField(Field);

  return Field;
};

export default createField;