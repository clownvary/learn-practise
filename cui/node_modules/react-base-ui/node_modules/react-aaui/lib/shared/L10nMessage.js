'use strict';

exports.__esModule = true;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _L10n = require('./L10n');

var _L10n2 = _interopRequireDefault(_L10n);

var _getContext = require('./getContext');

var _getContext2 = _interopRequireDefault(_getContext);

var _utils = require('./utils');

var _types = require('./types');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var propTypes = (0, _extends3.default)({}, _types.aauiL10nPropTypes);

var L10nMessage = function (_PureComponent) {
  (0, _inherits3.default)(L10nMessage, _PureComponent);

  function L10nMessage(props, context) {
    (0, _classCallCheck3.default)(this, L10nMessage);

    var _this = (0, _possibleConstructorReturn3.default)(this, _PureComponent.call(this, props, context));

    _this.l10n = props.aauiL10n || context.aauiL10n || new _L10n2.default();
    _this.unsubscribe = null;
    return _this;
  }

  L10nMessage.prototype.componentDidMount = function componentDidMount() {
    var _this2 = this;

    // Todo: maybe we should use `setState` instead of `forceUpdate` here
    this.unsubscribe = this.l10n.subscribe(function () {
      return _this2.forceUpdate();
    });
  };

  L10nMessage.prototype.componentWillUnmount = function componentWillUnmount() {
    if (this.unsubscribe) {
      this.unsubscribe();
    }

    this.unsubscribe = null;
  };

  L10nMessage.prototype.render = function render() {
    var _props = this.props,
        id = _props.id,
        values = _props.values;
    var messages = this.l10n.messages;


    return _react2.default.createElement(
      'span',
      null,
      messages[id] ? (0, _utils.interpolate)(messages[id], values) : id
    );
  };

  return L10nMessage;
}(_react.PureComponent);

L10nMessage.propTypes = propTypes;

exports.default = (0, _getContext2.default)((0, _extends3.default)({}, _types.aauiL10nPropTypes))(L10nMessage);
module.exports = exports['default'];