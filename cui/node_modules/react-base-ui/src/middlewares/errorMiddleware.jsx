import React from 'react';
import { ErrorObj, ErrorTypeEnum } from '../errors';
import { confirm } from '../confirmation';
import { showError } from '../messages';

const doConfirm = (title, messages) => {
  const msgs = messages.map((line, index) => <div key={index}>{line}</div>);
  confirm(msgs, { title });
};

export default () => next => (action) => {
  if (!action.error) {
    return next(action);
  }

  const error = action.payload;
  if (ErrorObj.isException(error)) {
    confirm(error.message, { title: 'Exception' });
  } else if (ErrorObj.isErrorObj(error)) {
    let title = 'Error';

    switch (error.type) {
      case ErrorTypeEnum.HTTP:
        title = error.messageGroup.title || 'HTTP Error';
        doConfirm(title, error.messageGroup.messages);
        break;

      case ErrorTypeEnum.SERVICE:
        title = error.messageGroup.title || 'Service Error';
        doConfirm(title, error.messageGroup.messages);
        break;

      case ErrorTypeEnum.APP:
        showError(error.messageGroup);
        break;

      default:
        break;
    }
  }

  return action;
};
